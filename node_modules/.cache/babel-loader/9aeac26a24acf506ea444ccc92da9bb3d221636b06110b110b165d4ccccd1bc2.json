{"ast":null,"code":"/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { find, omit } from '../../util/object.js';\nimport { toQueryString } from '../../util/url.js';\nimport AuthSdkError from '../../errors/AuthSdkError.js';\nimport { get } from '../../http/request.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { postToTransaction } from '../api.js';\nimport { addStateToken } from './stateToken.js';\nfunction link2fn(sdk, tx, res, obj, link, ref) {\n  if (Array.isArray(link)) {\n    return function (name, opts) {\n      if (!name) {\n        throw new AuthSdkError('Must provide a link name');\n      }\n      var lk = find(link, {\n        name: name\n      });\n      if (!lk) {\n        throw new AuthSdkError('No link found for that name');\n      }\n      return link2fn(sdk, tx, res, obj, lk, ref)(opts);\n    };\n  } else if (link.hints && link.hints.allow && link.hints.allow.length === 1) {\n    var method = link.hints.allow[0];\n    switch (method) {\n      case 'GET':\n        return function () {\n          return get(sdk, link.href, {\n            withCredentials: true\n          });\n        };\n      case 'POST':\n        return function (opts) {\n          if (ref && ref.isPolling) {\n            ref.isPolling = false;\n          }\n          var data = addStateToken(res, opts);\n          if (res.status === 'MFA_ENROLL' || res.status === 'FACTOR_ENROLL') {\n            Object.assign(data, {\n              factorType: obj.factorType,\n              provider: obj.provider\n            });\n          }\n          var params = {};\n          var autoPush = data.autoPush;\n          if (autoPush !== undefined) {\n            if (typeof autoPush === 'function') {\n              try {\n                params.autoPush = !!autoPush();\n              } catch (e) {\n                return Promise.reject(new AuthSdkError('AutoPush resulted in an error.'));\n              }\n            } else if (autoPush !== null) {\n              params.autoPush = !!autoPush;\n            }\n            data = omit(data, 'autoPush');\n          }\n          var rememberDevice = data.rememberDevice;\n          if (rememberDevice !== undefined) {\n            if (typeof rememberDevice === 'function') {\n              try {\n                params.rememberDevice = !!rememberDevice();\n              } catch (e) {\n                return Promise.reject(new AuthSdkError('RememberDevice resulted in an error.'));\n              }\n            } else if (rememberDevice !== null) {\n              params.rememberDevice = !!rememberDevice;\n            }\n            data = omit(data, 'rememberDevice');\n          } else if (data.profile && data.profile.updatePhone !== undefined) {\n            if (data.profile.updatePhone) {\n              params.updatePhone = true;\n            }\n            data.profile = omit(data.profile, 'updatePhone');\n          }\n          var href = link.href + toQueryString(params);\n          return postToTransaction(sdk, tx, href, data);\n        };\n    }\n  }\n}\nexport { link2fn };","map":{"version":3,"names":["link2fn","sdk","tx","res","obj","link","ref","Array","isArray","name","opts","AuthSdkError","lk","find","hints","allow","length","method","get","href","withCredentials","isPolling","data","addStateToken","status","Object","assign","factorType","provider","params","autoPush","undefined","e","Promise","reject","omit","rememberDevice","profile","updatePhone","toQueryString","postToTransaction"],"sources":["/Users/aadar00/Library/CloudStorage/OneDrive-BlackhawkNetwork,Inc/Documents/image-moderation-app/frontend/node_modules/@okta/lib/authn/util/link2fn.ts"],"sourcesContent":["import { OktaAuthHttpInterface } from '../../http/types';\nimport { find, omit, toQueryString } from '../../util';\nimport AuthSdkError from '../../errors/AuthSdkError';\nimport { get } from '../../http';\nimport { AuthnTransactionAPI, AuthnTransactionState } from '../types';\nimport { postToTransaction } from '../api';\nimport { addStateToken } from './stateToken';\n\n\n// query parameters to post url\ninterface PostToTransactionParams {\n  autoPush?: boolean;\n  rememberDevice?: boolean;\n  updatePhone?: boolean;\n}\n\n// eslint-disable-next-line max-params\nexport function link2fn(sdk: OktaAuthHttpInterface, tx: AuthnTransactionAPI, res, obj, link, ref) {\n  if (Array.isArray(link)) {\n    return function(name, opts?) {\n      if (!name) {\n        throw new AuthSdkError('Must provide a link name');\n      }\n\n      var lk = find(link, {name: name});\n      if (!lk) {\n        throw new AuthSdkError('No link found for that name');\n      }\n\n      return link2fn(sdk, tx, res, obj, lk, ref)(opts);\n    };\n\n  } else if (link.hints &&\n      link.hints.allow &&\n      link.hints.allow.length === 1) {\n    var method = link.hints.allow[0];\n    switch (method) {\n\n      case 'GET':\n        return function() {\n          return get(sdk, link.href, { withCredentials: true });\n        };\n\n      case 'POST':\n        // eslint-disable-next-line max-statements,complexity\n        return function(opts: AuthnTransactionState) {\n          if (ref && ref.isPolling) {\n            ref.isPolling = false;\n          }\n\n          var data = addStateToken(res, opts);\n\n          if (res.status === 'MFA_ENROLL' || res.status === 'FACTOR_ENROLL') {\n            // Add factorType and provider\n            Object.assign(data, {\n              factorType: obj.factorType,\n              provider: obj.provider\n            });\n          }\n\n          var params = {} as PostToTransactionParams;\n          var autoPush = data.autoPush;\n          if (autoPush !== undefined) {\n            if (typeof autoPush === 'function') {\n              try {\n                params.autoPush = !!autoPush();\n              }\n              catch (e) {\n                return Promise.reject(new AuthSdkError('AutoPush resulted in an error.'));\n              }\n            }\n            else if (autoPush !== null) {\n              params.autoPush = !!autoPush;\n            }\n            data = omit(data, 'autoPush');\n          }\n\n          var rememberDevice = data.rememberDevice;\n          if (rememberDevice !== undefined) {\n            if (typeof rememberDevice === 'function') {\n              try {\n                params.rememberDevice = !!rememberDevice();\n              }\n              catch (e) {\n                return Promise.reject(new AuthSdkError('RememberDevice resulted in an error.'));\n              }\n            }\n            else if (rememberDevice !== null) {\n              params.rememberDevice = !!rememberDevice;\n            }\n            data = omit(data, 'rememberDevice');\n\n          } else if (data.profile &&\n                    data.profile.updatePhone !== undefined) {\n            if (data.profile.updatePhone) {\n              params.updatePhone = true;\n            }\n            data.profile = omit(data.profile, 'updatePhone');\n          }\n          var href = link.href + toQueryString(params);\n          return postToTransaction(sdk, tx, href, data);\n        };\n    }\n  }\n}\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}