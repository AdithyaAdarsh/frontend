{"ast":null,"code":"import _regeneratorRuntime from \"/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { BroadcastChannel, createLeaderElection } from 'broadcast-channel';\nimport { isBrowser } from '../features.js';\nvar LeaderElectionService = /*#__PURE__*/function () {\n  function LeaderElectionService() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, LeaderElectionService);\n    this.started = false;\n    this.options = options;\n    this.onLeaderDuplicate = this.onLeaderDuplicate.bind(this);\n    this.onLeader = this.onLeader.bind(this);\n  }\n  _createClass(LeaderElectionService, [{\n    key: \"onLeaderDuplicate\",\n    value: function onLeaderDuplicate() {}\n  }, {\n    key: \"onLeader\",\n    value: function () {\n      var _onLeader = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _a, _b;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return (_b = (_a = this.options).onLeader) === null || _b === void 0 ? void 0 : _b.call(_a);\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function onLeader() {\n        return _onLeader.apply(this, arguments);\n      }\n      return onLeader;\n    }()\n  }, {\n    key: \"isLeader\",\n    value: function isLeader() {\n      var _a;\n      return !!((_a = this.elector) === null || _a === void 0 ? void 0 : _a.isLeader);\n    }\n  }, {\n    key: \"hasLeader\",\n    value: function hasLeader() {\n      var _a;\n      return !!((_a = this.elector) === null || _a === void 0 ? void 0 : _a.hasLeader);\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var electionChannelName;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (this.canStart()) {\n                electionChannelName = this.options.electionChannelName;\n                this.channel = new BroadcastChannel(electionChannelName);\n                this.elector = createLeaderElection(this.channel);\n                this.elector.onduplicate = this.onLeaderDuplicate;\n                this.elector.awaitLeadership().then(this.onLeader);\n                this.started = true;\n              }\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function start() {\n        return _start.apply(this, arguments);\n      }\n      return start;\n    }()\n  }, {\n    key: \"stop\",\n    value: function () {\n      var _stop = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!this.started) {\n                _context3.next = 11;\n                break;\n              }\n              if (!this.elector) {\n                _context3.next = 5;\n                break;\n              }\n              _context3.next = 4;\n              return this.elector.die();\n            case 4:\n              this.elector = undefined;\n            case 5:\n              if (!this.channel) {\n                _context3.next = 10;\n                break;\n              }\n              this.channel.postInternal = function () {\n                return Promise.resolve();\n              };\n              _context3.next = 9;\n              return this.channel.close();\n            case 9:\n              this.channel = undefined;\n            case 10:\n              this.started = false;\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function stop() {\n        return _stop.apply(this, arguments);\n      }\n      return stop;\n    }()\n  }, {\n    key: \"requiresLeadership\",\n    value: function requiresLeadership() {\n      return false;\n    }\n  }, {\n    key: \"isStarted\",\n    value: function isStarted() {\n      return this.started;\n    }\n  }, {\n    key: \"canStart\",\n    value: function canStart() {\n      return isBrowser() && !this.started;\n    }\n  }]);\n  return LeaderElectionService;\n}();\nexport { LeaderElectionService };","map":{"version":3,"names":["LeaderElectionService","options","arguments","length","undefined","_classCallCheck","started","onLeaderDuplicate","bind","onLeader","_createClass","key","value","_onLeader","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_a","_b","wrap","_callee$","_context","prev","next","call","stop","apply","isLeader","elector","hasLeader","_start","_callee2","electionChannelName","_callee2$","_context2","canStart","channel","BroadcastChannel","createLeaderElection","onduplicate","awaitLeadership","then","start","_stop","_callee3","_callee3$","_context3","die","postInternal","Promise","resolve","close","requiresLeadership","isStarted","isBrowser"],"sources":["/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@okta/lib/services/LeaderElectionService.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n\nimport { ServiceInterface, ServiceManagerOptions } from '../core/types';\nimport {\n  BroadcastChannel,\n  createLeaderElection,\n  LeaderElector\n} from 'broadcast-channel';\nimport { isBrowser } from '../features';\n\ndeclare type OnLeaderHandler = (() => Promise<void>);\ndeclare type ServiceOptions = ServiceManagerOptions & {\n  onLeader?: OnLeaderHandler;\n};\n\nexport class LeaderElectionService implements ServiceInterface {\n  private options: ServiceOptions;\n  private channel?: BroadcastChannel;\n  private elector?: LeaderElector;\n  private started = false;\n\n  constructor(options: ServiceOptions = {}) {\n    this.options = options;\n    this.onLeaderDuplicate = this.onLeaderDuplicate.bind(this);\n    this.onLeader = this.onLeader.bind(this);\n  }\n\n  private onLeaderDuplicate() {\n  }\n\n  private async onLeader() {\n    await this.options.onLeader?.();\n  }\n\n  isLeader() {\n    return !!this.elector?.isLeader;\n  }\n\n  hasLeader() {\n    return !!this.elector?.hasLeader;\n  }\n\n  async start() {\n    if (this.canStart()) {\n      const { electionChannelName } = this.options;\n      this.channel = new BroadcastChannel(electionChannelName as string);\n      this.elector = createLeaderElection(this.channel);\n      this.elector.onduplicate = this.onLeaderDuplicate;\n      this.elector.awaitLeadership().then(this.onLeader);\n      this.started = true;\n    }\n  }\n\n  async stop() {\n    if (this.started) {\n      if (this.elector) {\n        await this.elector.die();\n        this.elector = undefined;\n      }\n      if (this.channel) {\n        // Workaround to fix error `Failed to execute 'postMessage' on 'BroadcastChannel': Channel is closed`\n        (this.channel as any).postInternal = () => Promise.resolve();\n        await this.channel.close();\n        this.channel = undefined;\n      }\n      this.started = false;\n    }\n  }\n\n  requiresLeadership() {\n    return false;\n  }\n\n  isStarted() {\n    return this.started;\n  }\n\n  canStart() {\n    return isBrowser() && !this.started;\n  }\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}