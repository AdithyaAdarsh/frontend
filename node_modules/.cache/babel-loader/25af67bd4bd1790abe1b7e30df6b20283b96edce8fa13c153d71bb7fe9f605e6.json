{"ast":null,"code":"import _regeneratorRuntime from \"/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { isFunction } from '../util/types.js';\nimport AuthSdkError from '../errors/AuthSdkError.js';\nimport OAuthError from '../errors/OAuthError.js';\nimport { httpRequest } from '../http/request.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { isAccessToken, isIDToken } from './types/Token.js';\nfunction getUserInfo(_x, _x2, _x3) {\n  return _getUserInfo.apply(this, arguments);\n}\nfunction _getUserInfo() {\n  _getUserInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(sdk, accessTokenObject, idTokenObject) {\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if (accessTokenObject) {\n            _context.next = 4;\n            break;\n          }\n          _context.next = 3;\n          return sdk.tokenManager.getTokens();\n        case 3:\n          accessTokenObject = _context.sent.accessToken;\n        case 4:\n          if (idTokenObject) {\n            _context.next = 8;\n            break;\n          }\n          _context.next = 7;\n          return sdk.tokenManager.getTokens();\n        case 7:\n          idTokenObject = _context.sent.idToken;\n        case 8:\n          if (!(!accessTokenObject || !isAccessToken(accessTokenObject))) {\n            _context.next = 10;\n            break;\n          }\n          return _context.abrupt(\"return\", Promise.reject(new AuthSdkError('getUserInfo requires an access token object')));\n        case 10:\n          if (!(!idTokenObject || !isIDToken(idTokenObject))) {\n            _context.next = 12;\n            break;\n          }\n          return _context.abrupt(\"return\", Promise.reject(new AuthSdkError('getUserInfo requires an ID token object')));\n        case 12:\n          return _context.abrupt(\"return\", httpRequest(sdk, {\n            url: accessTokenObject.userinfoUrl,\n            method: 'GET',\n            accessToken: accessTokenObject.accessToken\n          }).then(function (userInfo) {\n            if (userInfo.sub === idTokenObject.claims.sub) {\n              return userInfo;\n            }\n            return Promise.reject(new AuthSdkError('getUserInfo request was rejected due to token mismatch'));\n          }).catch(function (err) {\n            if (err.xhr && (err.xhr.status === 401 || err.xhr.status === 403)) {\n              var authenticateHeader;\n              if (err.xhr.headers && isFunction(err.xhr.headers.get) && err.xhr.headers.get('WWW-Authenticate')) {\n                authenticateHeader = err.xhr.headers.get('WWW-Authenticate');\n              } else if (isFunction(err.xhr.getResponseHeader)) {\n                authenticateHeader = err.xhr.getResponseHeader('WWW-Authenticate');\n              }\n              if (authenticateHeader) {\n                var errorMatches = authenticateHeader.match(/error=\"(.*?)\"/) || [];\n                var errorDescriptionMatches = authenticateHeader.match(/error_description=\"(.*?)\"/) || [];\n                var error = errorMatches[1];\n                var errorDescription = errorDescriptionMatches[1];\n                if (error && errorDescription) {\n                  err = new OAuthError(error, errorDescription);\n                }\n              }\n            }\n            throw err;\n          }));\n        case 13:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return _getUserInfo.apply(this, arguments);\n}\nexport { getUserInfo };","map":{"version":3,"names":["getUserInfo","_x","_x2","_x3","_getUserInfo","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","sdk","accessTokenObject","idTokenObject","wrap","_callee$","_context","prev","next","tokenManager","getTokens","sent","accessToken","idToken","isAccessToken","abrupt","Promise","reject","AuthSdkError","isIDToken","httpRequest","url","userinfoUrl","method","then","userInfo","sub","claims","catch","err","xhr","status","authenticateHeader","headers","isFunction","get","getResponseHeader","errorMatches","match","errorDescriptionMatches","error","errorDescription","OAuthError","stop"],"sources":["/Users/aadar00/Documents/image-moderation-app/frontend/node_modules/@okta/lib/oidc/getUserInfo.ts"],"sourcesContent":["/* eslint-disable complexity */\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\nimport { isFunction } from '../util';\nimport { AuthSdkError, OAuthError } from '../errors';\nimport { httpRequest } from '../http';\nimport { AccessToken, IDToken, UserClaims, isAccessToken, isIDToken, CustomUserClaims } from './types';\n\nexport async function getUserInfo<T extends CustomUserClaims = CustomUserClaims>(\n  sdk, accessTokenObject: AccessToken,\n  idTokenObject: IDToken\n): Promise<UserClaims<T>> {\n  // If token objects were not passed, attempt to read from the TokenManager\n  if (!accessTokenObject) {\n    accessTokenObject = (await sdk.tokenManager.getTokens()).accessToken as AccessToken;\n  }\n  if (!idTokenObject) {\n    idTokenObject = (await sdk.tokenManager.getTokens()).idToken as IDToken;\n  }\n\n  if (!accessTokenObject || !isAccessToken(accessTokenObject)) {\n    return Promise.reject(new AuthSdkError('getUserInfo requires an access token object'));\n  }\n\n  if (!idTokenObject || !isIDToken(idTokenObject)) {\n    return Promise.reject(new AuthSdkError('getUserInfo requires an ID token object'));\n  }\n\n  return httpRequest(sdk, {\n    url: accessTokenObject.userinfoUrl,\n    method: 'GET',\n    accessToken: accessTokenObject.accessToken\n  })\n    .then(userInfo => {\n      // Only return the userinfo response if subjects match to mitigate token substitution attacks\n      if (userInfo.sub === idTokenObject.claims.sub) {\n        return userInfo;\n      }\n      return Promise.reject(new AuthSdkError('getUserInfo request was rejected due to token mismatch'));\n    })\n    .catch(function (err) {\n      if (err.xhr && (err.xhr.status === 401 || err.xhr.status === 403)) {\n        var authenticateHeader;\n        if (err.xhr.headers && isFunction(err.xhr.headers.get) && err.xhr.headers.get('WWW-Authenticate')) {\n          authenticateHeader = err.xhr.headers.get('WWW-Authenticate');\n        } else if (isFunction(err.xhr.getResponseHeader)) {\n          authenticateHeader = err.xhr.getResponseHeader('WWW-Authenticate');\n        }\n        if (authenticateHeader) {\n          var errorMatches = authenticateHeader.match(/error=\"(.*?)\"/) || [];\n          var errorDescriptionMatches = authenticateHeader.match(/error_description=\"(.*?)\"/) || [];\n          var error = errorMatches[1];\n          var errorDescription = errorDescriptionMatches[1];\n          if (error && errorDescription) {\n            err = new OAuthError(error, errorDescription);\n          }\n        }\n      }\n      throw err;\n    });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}