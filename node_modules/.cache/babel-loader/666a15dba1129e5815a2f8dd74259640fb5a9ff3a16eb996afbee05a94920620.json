{"ast":null,"code":"/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport AuthPollStopError from '../../errors/AuthPollStopError.js';\nimport AuthSdkError from '../../errors/AuthSdkError.js';\nimport { delay } from '../../util/misc.js';\nimport { getLink } from '../../util/object.js';\nimport { isNumber, isObject } from '../../util/types.js';\nimport { toQueryString } from '../../util/url.js';\nimport { post } from '../../http/request.js';\nimport { DEFAULT_POLLING_DELAY } from '../../constants.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { getStateToken } from './stateToken.js';\nfunction getPollFn(sdk, res, ref) {\n  return function (options) {\n    var delay$1;\n    var rememberDevice;\n    var autoPush;\n    var transactionCallBack;\n    if (isNumber(options)) {\n      delay$1 = options;\n    } else if (isObject(options)) {\n      options = options;\n      delay$1 = options.delay;\n      rememberDevice = options.rememberDevice;\n      autoPush = options.autoPush;\n      transactionCallBack = options.transactionCallBack;\n    }\n    if (!delay$1 && delay$1 !== 0) {\n      delay$1 = DEFAULT_POLLING_DELAY;\n    }\n    var pollLink = getLink(res, 'next', 'poll');\n    function pollFn() {\n      var opts = {};\n      if (typeof autoPush === 'function') {\n        try {\n          opts.autoPush = !!autoPush();\n        } catch (e) {\n          return Promise.reject(new AuthSdkError('AutoPush resulted in an error.'));\n        }\n      } else if (autoPush !== undefined && autoPush !== null) {\n        opts.autoPush = !!autoPush;\n      }\n      if (typeof rememberDevice === 'function') {\n        try {\n          opts.rememberDevice = !!rememberDevice();\n        } catch (e) {\n          return Promise.reject(new AuthSdkError('RememberDevice resulted in an error.'));\n        }\n      } else if (rememberDevice !== undefined && rememberDevice !== null) {\n        opts.rememberDevice = !!rememberDevice;\n      }\n      var href = pollLink.href + toQueryString(opts);\n      return post(sdk, href, getStateToken(res), {\n        saveAuthnState: false,\n        withCredentials: true\n      });\n    }\n    ref.isPolling = true;\n    var retryCount = 0;\n    var recursivePoll = function () {\n      if (!ref.isPolling) {\n        return Promise.reject(new AuthPollStopError());\n      }\n      return pollFn().then(function (pollRes) {\n        retryCount = 0;\n        if (pollRes.factorResult && pollRes.factorResult === 'WAITING') {\n          if (!ref.isPolling) {\n            throw new AuthPollStopError();\n          }\n          if (typeof transactionCallBack === 'function') {\n            transactionCallBack(pollRes);\n          }\n          return delay(delay$1).then(recursivePoll);\n        } else {\n          ref.isPolling = false;\n          return sdk.tx.createTransaction(pollRes);\n        }\n      }).catch(function (err) {\n        if (err.xhr && (err.xhr.status === 0 || err.xhr.status === 429) && retryCount <= 4) {\n          var delayLength = Math.pow(2, retryCount) * 1000;\n          retryCount++;\n          return delay(delayLength).then(recursivePoll);\n        }\n        throw err;\n      });\n    };\n    return recursivePoll().catch(function (err) {\n      ref.isPolling = false;\n      throw err;\n    });\n  };\n}\nexport { getPollFn };","map":{"version":3,"names":["getPollFn","sdk","res","ref","options","delay$1","rememberDevice","autoPush","transactionCallBack","isNumber","isObject","delay","DEFAULT_POLLING_DELAY","pollLink","getLink","pollFn","opts","e","Promise","reject","AuthSdkError","undefined","href","toQueryString","post","getStateToken","saveAuthnState","withCredentials","isPolling","retryCount","recursivePoll","AuthPollStopError","then","pollRes","factorResult","tx","createTransaction","catch","err","xhr","status","delayLength","Math","pow"],"sources":["/Users/aadar00/Library/CloudStorage/OneDrive-BlackhawkNetwork,Inc/Documents/image-moderation-app/frontend/node_modules/@okta/lib/authn/util/poll.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\nimport { post } from '../../http';\nimport { isNumber, isObject, getLink, toQueryString, delay as delayFn } from '../../util';\nimport { DEFAULT_POLLING_DELAY } from '../../constants';\nimport AuthSdkError from '../../errors/AuthSdkError';\nimport AuthPollStopError from '../../errors/AuthPollStopError';\nimport { AuthnTransactionState } from '../types';\nimport { getStateToken } from './stateToken';\n\ninterface PollOptions {\n  delay?: number;\n  rememberDevice?: boolean;\n  autoPush?: boolean;\n  transactionCallBack?: (AuthnTransactionState) => void;\n}\n\nexport function getPollFn(sdk, res: AuthnTransactionState, ref) {\n  return function (options: PollOptions | number) {\n    var delay;\n    var rememberDevice;\n    var autoPush;\n    var transactionCallBack;\n\n    if (isNumber(options)) {\n      delay = options;\n    } else if (isObject(options)) {\n      options = options as PollOptions;\n      delay = options.delay;\n      rememberDevice = options.rememberDevice;\n      autoPush = options.autoPush;\n      transactionCallBack = options.transactionCallBack;\n    }\n\n    if (!delay && delay !== 0) {\n      delay = DEFAULT_POLLING_DELAY;\n    }\n\n    // Get the poll function\n    var pollLink = getLink(res, 'next', 'poll');\n    // eslint-disable-next-line complexity\n    function pollFn() {\n      var opts = {} as PollOptions;\n      if (typeof autoPush === 'function') {\n        try {\n          opts.autoPush = !!autoPush();\n        }\n        catch (e) {\n          return Promise.reject(new AuthSdkError('AutoPush resulted in an error.'));\n        }\n      }\n      else if (autoPush !== undefined && autoPush !== null) {\n        opts.autoPush = !!autoPush;\n      }\n      if (typeof rememberDevice === 'function') {\n        try {\n          opts.rememberDevice = !!rememberDevice();\n        }\n        catch (e) {\n          return Promise.reject(new AuthSdkError('RememberDevice resulted in an error.'));\n        }\n      }\n      else if (rememberDevice !== undefined && rememberDevice !== null) {\n        opts.rememberDevice = !!rememberDevice;\n      }\n\n      var href = pollLink.href + toQueryString(opts);\n      return post(sdk, href, getStateToken(res), {\n        saveAuthnState: false,\n        withCredentials: true\n      });\n    }\n\n    ref.isPolling = true;\n\n    var retryCount = 0;\n    var recursivePoll = function () {\n      // If the poll was manually stopped during the delay\n      if (!ref.isPolling) {\n        return Promise.reject(new AuthPollStopError());\n      }\n      return pollFn()\n        .then(function (pollRes) {\n          // Reset our retry counter on success\n          retryCount = 0;\n\n          // If we're still waiting\n          if (pollRes.factorResult && pollRes.factorResult === 'WAITING') {\n\n            // If the poll was manually stopped while the pollFn was called\n            if (!ref.isPolling) {\n              throw new AuthPollStopError();\n            }\n\n            if (typeof transactionCallBack === 'function') {\n              transactionCallBack(pollRes);\n            }\n\n            // Continue poll\n            return delayFn(delay).then(recursivePoll);\n\n          } else {\n            // Any non-waiting result, even if polling was stopped\n            // during a request, will return\n            ref.isPolling = false;\n            return sdk.tx.createTransaction(pollRes);\n          }\n        })\n        .catch(function(err) {\n          // Exponential backoff, up to 16 seconds\n          if (err.xhr &&\n              (err.xhr.status === 0 || err.xhr.status === 429) &&\n              retryCount <= 4) {\n            var delayLength = Math.pow(2, retryCount) * 1000;\n            retryCount++;\n            return delayFn(delayLength)\n              .then(recursivePoll);\n          }\n          throw err;\n        });\n    };\n    return recursivePoll()\n      .catch(function(err) {\n        ref.isPolling = false;\n        throw err;\n      });\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}